const nodemailer = require('nodemailer');

exports.handler = async (event) => {
  if (event.httpMethod !== 'POST') {
    return {
      statusCode: 405,
      body: JSON.stringify({ error: 'Method Not Allowed' }),
    };
  }

  try {
    const { name, surname, email, message } = JSON.parse(event.body);

    // Validación básica de los datos
    if (!name || !surname || !email || !message) {
      return {
        statusCode: 400,
        body: JSON.stringify({ error: 'Todos los campos son obligatorios.' }),
      };
    }

    // Configuración del transporte de Nodemailer para Zoho
    const transporter = nodemailer.createTransport({
      host: 'smtp.zoho.com',
      port: 465,
      secure: true, // true para conexiones SSL/TLS
      auth: {
        user: 'info@tec365.shop', // Tu correo de Zoho
        pass: process.env.ZOHO_PASS, // Contraseña o App Password configurada en Zoho
      },
    });

    // Configuración del correo
    const mailOptions = {
      from: `"${name} ${surname}" <${email}>`, // Remitente
      to: 'info@tec365.shop', // Tu correo de Zoho
      subject: 'Nuevo mensaje desde el formulario de contacto', // Asunto
      text: `Nombre: ${name} ${surname}\nCorreo: ${email}\nMensaje:\n${message}`, // Cuerpo del correo en texto plano
    };

    // Enviar el correo
    await transporter.sendMail(mailOptions);

    return {
      statusCode: 200,
      body: JSON.stringify({ message: 'Correo enviado correctamente.' }),
    };
  } catch (error) {
    console.error('Error al enviar el correo:', error);
    return {
      statusCode: 500,
      body: JSON.stringify({ error: 'Hubo un problema al enviar el correo.' }),
    };
  }
};